trigger:
- main

jobs:
  - job: Build
    displayName: "Build"
    pool:
      name: Azure Pipelines
      vmImage: "windows-2019"
    
    steps:

      - task: DotNetCoreCLI@2
        displayName: Restore
        inputs:
          command: restore
          projects: '**/**/*.csproj'
      
      - task: DotNetCoreCLI@2
        displayName: Build
        inputs:
          projects: '**/**/*.csproj'
          arguments: '--configuration Release'
      
      - task: DotNetCoreCLI@2
        displayName: Publish
        inputs:
          command: publish
          publishWebProjects: false
          projects: '**/**/*.csproj'
          arguments: '--configuration Release --output $(Build.ArtifactStagingDirectory)'
          zipAfterPublish: true

      - task: PublishBuildArtifacts@1
        displayName: "Publish Artifact"
        inputs:
          PathtoPublish: '$(Build.ArtifactStagingDirectory)'
        condition: succeededOrFailed()
      
      - task: PackageAzureDevOpsExtension@3
        inputs:
          rootFolder: 'Build.ArtifactStagingDirectory'
          outputPath: 'Extension.OutputPath'
          publisherId: 'dimaros'
          updateTasksVersion: true
          extensionVisibility: 'private'
          extensionPricing: 'free'
          zipAfterPublish: true